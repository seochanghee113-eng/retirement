import React, { useState } from 'react';
import { Calculator } from 'lucide-react';

export default function RetirementTaxCalculator() {
  const [years, setYears] = useState('');
  const [amount, setAmount] = useState('');
  const [result, setResult] = useState(null);

  // 근속연수공제 계산 (2023년 1월 1일 이후 적용)
  const calculateServiceYearDeduction = (years) => {
    if (years <= 5) {
      return years * 1000000;
    } else if (years <= 10) {
      return 5000000 + (years - 5) * 2000000;
    } else if (years <= 20) {
      return 15000000 + (years - 10) * 2500000;
    } else {
      return 40000000 + (years - 20) * 3000000;
    }
  };

  // 환산급여공제 계산
  const calculateConvertedSalaryDeduction = (convertedSalary) => {
    if (convertedSalary <= 8000000) {
      return convertedSalary;
    } else if (convertedSalary <= 70000000) {
      return 8000000 + (convertedSalary - 8000000) * 0.6;
    } else if (convertedSalary <= 100000000) {
      return 45200000 + (convertedSalary - 70000000) * 0.55;
    } else if (convertedSalary <= 300000000) {
      return 61700000 + (convertedSalary - 100000000) * 0.45;
    } else {
      return 151700000 + (convertedSalary - 300000000) * 0.35;
    }
  };

  // 과세표준에 대한 세율 적용
  const calculateTaxByBracket = (taxBase) => {
    if (taxBase <= 14000000) {
      return taxBase * 0.06;
    } else if (taxBase <= 50000000) {
      return taxBase * 0.15 - 1260000;
    } else if (taxBase <= 88000000) {
      return taxBase * 0.24 - 5760000;
    } else if (taxBase <= 150000000) {
      return taxBase * 0.35 - 15440000;
    } else if (taxBase <= 300000000) {
      return taxBase * 0.38 - 19940000;
    } else if (taxBase <= 500000000) {
      return taxBase * 0.40 - 25940000;
    } else if (taxBase <= 1000000000) {
      return taxBase * 0.42 - 35940000;
    } else {
      return taxBase * 0.45 - 65940000;
    }
  };

  const calculateTax = () => {
    const yearsNum = parseFloat(years);
    const amountNum = parseFloat(amount);

    if (!yearsNum || yearsNum <= 0 || !amountNum || amountNum <= 0) {
      alert('올바른 값을 입력해주세요.');
      return;
    }

    // 1. 퇴직소득금액 (비과세소득 없다고 가정)
    const retirementIncome = amountNum;
    
    // 2. 근속연수공제
    const serviceYearDeduction = calculateServiceYearDeduction(yearsNum);
    
    // 3. 환산급여 계산
    const convertedSalary = ((retirementIncome - serviceYearDeduction) * 12) / yearsNum;
    
    // 4. 환산급여공제
    const convertedSalaryDeduction = calculateConvertedSalaryDeduction(convertedSalary);
    
    // 5. 과세표준
    const taxBase = convertedSalary - convertedSalaryDeduction;
    
    // 6. 환산산출세액 (과세표준에 기본세율 적용)
    const convertedTax = calculateTaxByBracket(taxBase);
    
    // 7. 산출세액 (환산산출세액을 근속연수로 조정)
    const calculatedTax = (convertedTax / 12) * yearsNum;
    
    // 8. 지방소득세 (퇴직소득세의 10%)
    const localTax = calculatedTax * 0.1;
    
    // 9. 총 세액
    const totalTax = calculatedTax + localTax;
    
    // 10. 실수령액
    const netAmount = amountNum - totalTax;

    setResult({
      퇴직소득금액: retirementIncome,
      근속연수공제: serviceYearDeduction,
      환산급여: convertedSalary,
      환산급여공제: convertedSalaryDeduction,
      과세표준: taxBase,
      환산산출세액: convertedTax,
      산출세액: calculatedTax,
      지방소득세: localTax,
      총세액: totalTax,
      실수령액: netAmount
    });
  };

  const formatNumber = (num) => {
    return new Intl.NumberFormat('ko-KR').format(Math.round(num));
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
          <div className="flex items-center gap-3 mb-6">
            <Calculator className="w-8 h-8 text-indigo-600" />
            <h1 className="text-3xl font-bold text-gray-800">퇴직소득세 계산기</h1>
          </div>

          <div className="space-y-6">
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                근속연수 (년)
              </label>
              <input
                type="number"
                value={years}
                onChange={(e) => setYears(e.target.value)}
                placeholder="예: 10"
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg"
              />
            </div>

            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                퇴직소득금액 (원)
              </label>
              <input
                type="number"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                placeholder="예: 50000000"
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg"
              />
            </div>

            <button
              onClick={calculateTax}
              className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-lg transition-colors text-lg"
            >
              계산하기
            </button>
          </div>
        </div>

        {result && (
          <div className="bg-white rounded-2xl shadow-xl p-8">
            <h2 className="text-2xl font-bold text-gray-800 mb-6 border-b-2 pb-3">
              계산 결과
            </h2>
            
            <div className="space-y-3">
              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700 font-medium">① 퇴직소득금액</span>
                <span className="text-lg font-semibold text-gray-800">
                  {formatNumber(result.퇴직소득금액)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700 font-medium">② 근속연수공제</span>
                <span className="text-lg font-semibold text-blue-600">
                  {formatNumber(result.근속연수공제)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b bg-gray-50 px-3 rounded">
                <span className="text-gray-700 font-semibold">③ 환산급여</span>
                <span className="text-sm text-gray-600">
                  (①-②) × 12 ÷ 근속연수
                </span>
                <span className="text-lg font-bold text-gray-800">
                  {formatNumber(result.환산급여)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700 font-medium">④ 환산급여공제</span>
                <span className="text-lg font-semibold text-blue-600">
                  {formatNumber(result.환산급여공제)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b bg-indigo-50 px-3 rounded">
                <span className="text-indigo-700 font-semibold">⑤ 과세표준</span>
                <span className="text-lg font-bold text-indigo-700">
                  {formatNumber(result.과세표준)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700 font-medium">⑥ 환산산출세액</span>
                <span className="text-sm text-gray-600">
                  과세표준 × 세율
                </span>
                <span className="text-lg font-semibold text-gray-800">
                  {formatNumber(result.환산산출세액)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b bg-red-50 px-3 rounded">
                <span className="text-red-700 font-bold">⑦ 산출세액 (퇴직소득세)</span>
                <span className="text-sm text-gray-600">
                  ⑥ ÷ 12 × 근속연수
                </span>
                <span className="text-xl font-bold text-red-700">
                  {formatNumber(result.산출세액)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700 font-medium">⑧ 지방소득세 (10%)</span>
                <span className="text-lg font-semibold text-gray-800">
                  {formatNumber(result.지방소득세)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-4 bg-orange-50 px-4 rounded-lg mt-4">
                <span className="text-orange-700 font-bold text-lg">총 납부세액</span>
                <span className="text-2xl font-bold text-orange-700">
                  {formatNumber(result.총세액)}원
                </span>
              </div>

              <div className="flex justify-between items-center py-4 bg-green-50 px-4 rounded-lg">
                <span className="text-green-700 font-bold text-lg">실수령액</span>
                <span className="text-2xl font-bold text-green-700">
                  {formatNumber(result.실수령액)}원
                </span>
              </div>
            </div>

            <div className="mt-6 p-4 bg-blue-50 rounded-lg space-y-2">
              <p className="text-sm text-gray-700 font-semibold">📌 계산 방식 (2023년 1월 1일 이후 퇴직자 적용)</p>
              <p className="text-xs text-gray-600">
                • 근속연수공제: 근속기간에 따라 차등 적용<br/>
                • 환산급여: 퇴직소득을 연간 급여로 환산<br/>
                • 환산급여공제: 환산급여 금액에 따라 차등 공제<br/>
                • 산출세액: 환산산출세액을 다시 근속연수로 조정
              </p>
            </div>

            <div className="mt-4 p-4 bg-yellow-50 rounded-lg">
              <p className="text-xs text-gray-600">
                ※ 본 계산기는 2023년 세법 개정 이후 기준으로 계산됩니다.<br/>
                ※ 비과세 소득이 없고, 중간정산을 받지 않은 경우를 가정합니다.<br/>
                ※ 실제 세액은 개인의 상황에 따라 다를 수 있으니 참고용으로만 사용하세요.
              </p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}